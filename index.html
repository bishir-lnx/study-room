<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liberty Squad</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg:#0e0e0e; --card:#181818; --border:#2a2a2a; --primary:#1abc9c; --text:#eaeaea; --dim:#888; --red:#e74c3c; --accent:#3498db; }
        body { margin:0; background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
        .container { width:95%; max-width:1100px; margin-top:40px; }
        h1 { text-align:center; margin-bottom:30px; font-weight:700; }

        #identity-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.98); display:flex; flex-wrap:wrap; align-content:center; justify-content:center; gap:12px; padding:20px; z-index:100; }
        .identity-btn { background:var(--card); border:1px solid var(--primary); color:var(--primary); font-size:18px; padding:14px; border-radius:12px; cursor:pointer; width:160px; font-weight:600; transition:.2s; }
        .identity-btn:hover { background:var(--primary); color:#000; transform:translateY(-3px); }

        .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-bottom:40px; }
        .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:25px; text-align:center; position:relative; }
        .card.studying { border-color:var(--primary); box-shadow:0 0 25px rgba(26,188,156,.15); }

        .leader-badge { position:absolute; top:15px; left:15px; font-size:1.8rem; display:none; }
        .is-leader { border-color:gold!important; }
        .is-leader .leader-badge { display:block; }

        .reward-badge { position:absolute; top:15px; right:15px; font-size:1.8rem; }
        .name { font-size:1.3rem; font-weight:700; margin-bottom:5px; }
        .status-badge { display:inline-block; font-size:.8rem; padding:4px 12px; border-radius:20px; background:#222; color:var(--dim); margin-bottom:20px; }
        .card.studying .status-badge { background:rgba(26,188,156,.2); color:var(--primary); }

        .timer-display { font-size:2.8rem; font-weight:700; font-variant-numeric:tabular-nums; }
        .max-display { font-size:.85rem; color:var(--dim); margin-top:10px; }
        .break-msg { font-size:.8rem; color:var(--accent); background:rgba(52,152,219,.1); border:1px solid rgba(52,152,219,.2); padding:6px 12px; border-radius:8px; margin-top:15px; display:none; }

        .controls { margin-top:25px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
        button.action { padding:10px 14px; border-radius:8px; border:none; font-weight:600; cursor:pointer; font-size:.85rem; }
        .btn-toggle { background:var(--primary); color:#000; }
        .btn-focus { background:var(--accent); color:#fff; }
        .btn-pip { background:#333; color:#fff; border:1px solid #444; }
        .btn-reset { background:transparent; border:1px solid var(--red); color:var(--red); opacity:.6; }

        #pip-assets { position:fixed; left:-9999px; }
    </style>
</head>
<body>

<div id="identity-overlay">
    <h2 style="width:100%;text-align:center;color:white;">Select Your Profile</h2>
    <button class="identity-btn" onclick="setIdentity('Bishir')">Bishir</button>
    <button class="identity-btn" onclick="setIdentity('Sanjay')">Sanjay</button>
    <button class="identity-btn" onclick="setIdentity('Krishnan')">Krishnan</button>
    <button class="identity-btn" onclick="setIdentity('Kashi')">Kashi</button>
    <button class="identity-btn" onclick="setIdentity('Rony')">Rony</button>
    <button class="identity-btn" onclick="setIdentity('Sidharth')">Sidharth</button>
</div>

<div class="container">
    <h1>üóΩ Liberty Squad</h1>
    <div class="grid" id="user-grid"></div>
    <div id="history-box">...</div>
</div>

<div id="pip-assets">
    <canvas id="pip-canvas" width="240" height="100"></canvas>
    <video id="pip-video" autoplay muted playsinline loop></video>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ‚úÖ FIX: valid object + safe init
    let db = null;
    try {
        const firebaseConfig = {}; // <-- ONLY FIX
        const app = initializeApp(firebaseConfig);
        db = getDatabase(app);
    } catch (e) {
        console.warn("Firebase not initialized:", e);
    }

    const users = ['Bishir','Sanjay','Krishnan','Kashi','Rony','Sidharth'];
    const grid = document.getElementById('user-grid');

    users.forEach(u => {
        grid.innerHTML += `
        <div id="card-${u}" class="card">
            <div id="leader-${u}" class="leader-badge">üèÜ</div>
            <div id="reward-${u}" class="reward-badge">üå±</div>
            <div class="name">${u}</div>
            <div class="status-badge">Offline</div>
            <div class="timer-display">00:00:00</div>
            <div class="max-display">Max Session: 00:00:00</div>
            <div class="controls"><button class="action btn-pip" onclick="togglePiP()">PiP</button></div>
        </div>`;
    });

    const canvas = document.getElementById('pip-canvas');
    const ctx = canvas.getContext('2d');
    const video = document.getElementById('pip-video');

    window.togglePiP = async () => {
        if (document.pictureInPictureElement) {
            await document.exitPictureInPicture();
        } else {
            const stream = canvas.captureStream(30);
            video.srcObject = stream;
            await video.play();
            await video.requestPictureInPicture();
        }
    };

    setInterval(() => {
        ctx.fillStyle = '#181818';
        ctx.fillRect(0,0,240,100);
        ctx.fillStyle = '#eaeaea';
        ctx.font = 'bold 36px Inter';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('00:00:00',120,50);
    },1000);
</script>
</body>
</html>
